<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>chatterbox</title>
    <link rel="stylesheet" href="styles/styles.css">

    <!-- dependencies -->
    <script src="bower_components/jquery/jquery.min.js"></script>
    <script src="bower_components/underscore/underscore.js"></script>
    <!-- your scripts -->
    <script src="scripts/config.js"></script>
    <script src="scripts/app.js"></script>
    <script>
      $(document).ready(function() {
        var username = getQueryVariable('username');
        console.log(username);

        $('#send').on('click',function(){
          var message = {
            'username' : username,
            'text' : $('#input').val(),
            'roomname' : 'HackReactor'
          };
          $('#input').text = '';
          console.log(message);
          app.addMessage(message);
        });

        $('#rooms').on('change',function(){
            $("select option:selected").each(function() {
              console.log($(this).text());
              app.currentRoom = $(this).text();
              app.fetch($(this).text());

            });
          });

        app.fetch()
        setInterval(function(){
          console.log("Fetching");
          app.fetch(app.currentRoom);

        },4000);
      });

      var getQueryVariable = function(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
        }
        return(false);
      };
    </script>
  </head>
  <body>
     <div id="sidebar">
      <div id="room-container">
        <h2>Rooms</h2>
          <select id="rooms">
          </select>
      </div>
      <div id="friends-container">
        <h2>Friends</h2>
        <ul id="friends">
        </ul>
      </div>
    </div>
    <div id="main">
      <h1>chatterbox</h1>
      <div>
        <textarea id="input"></textarea>
        <button id="send">Send</button>
      </div>
      <ul id="chats">
      </ul>
    </div>
  </body>
</html>

